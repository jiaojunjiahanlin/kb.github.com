---
layout: post
title: bs64图片上传
---

# go语言交叉编译 #：
 <span>
 
    javascript代码：
    function putb64(){
	var pic = "填写你的bs64后的字符串";
    var url = "http://up.qiniu.com/putb64/20264"; 
	var xhr = new XMLHttpRequest();
	xhr.onreadystatechange=function(){
		if (xhr.readyState==4){
			document.getElementById("myDiv").innerHTML=xhr.responseText;
		}
	}
	xhr.open("POST", url, true); 
	xhr.setRequestHeader("Content-Type", "application/octet-stream"); 
	xhr.setRequestHeader("Authorization", "UpToken acmKu7Hie1OQ3t31bAovR6JORFX72MMpTicc2xje:xM2jjq-XFG8aWD5rm46LTwLg4N0=:eyJzY29wZSI6ImFhYTUiLCJkZWFkbGluZSI6MTQxMTk4OTk0MH0="); 
	xhr.send(pic);
	}  

 </span>
 
  <span>
  
	对应的java代码：
	
@Test
	public void putb64() throws Exception {
		FileInputStream fis = null;
		try{
			int l = (int)(new File(file).length());
			byte[] src = new byte[l];
			fis = new FileInputStream(new File(file));
			fis.read(src);
			String file64 = Base64.encodeBase64String(src);
			String url = "http://up.qiniu.com/putb64/" + l;
			System.out.println(url);
			HttpPost post = new HttpPost(url);
			post.addHeader("Content-Type", "application/octet-stream");
			post.addHeader("Authorization", "UpToken " + getToken());
			System.out.println( "UpToken " + getToken());
	//		post.setEntity(new ByteArrayEntity(src));
			post.setEntity(new StringEntity(file64));
			System.out.println(file64);
			HttpClient c = Http.getClient();
			HttpResponse res = c.execute(post);
			System.out.println(res.getStatusLine());
			String responseBody = EntityUtils.toString(
	                res.getEntity(), Config.CHARSET);
			System.out.println(responseBody);
		}catch(Exception e){
			e.printStackTrace();
			throw e;
		}finally{
			if(fis != null){
				fis.close();
			}
		}
	}

url 中具体指明 文件长度。
METHOD: POST
HOST: http://up.qiniu.com
PATH: /putb64/<Fsize>/key/<EncodedKey>/mimeType/<EncodedMimeType>/x:user-var/<EncodedUserVarVal>
REQUEST HEADER:
Authorization: UpToken <UpToken>
Content-Type: application/octet-stream
BODY:
<Base64EncodedFileContent>

<Fsize>: 文件大小，必选。支持传入 -1 表示文件大小以 http request body 为准。
<EncodedKey>: 可选，如果没有指定则：如果 uptoken.SaveKey 存在则基于 SaveKey 生产 key，否则用 hash 值作 key。
<EncodedMimeType>: 文件的 MIME 类型。可选，默认是 application/octet-stream。
`

 </span>